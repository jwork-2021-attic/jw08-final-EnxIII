## Java大实验报告

191220053 李懿明



#### 实验完成情况

jwork05差不多完成了

没有视频录制功能、没有JUnit单元测试、maven管理没有完成、没有存档功能、没有多玩家网络对战功能。





#### 项目介绍

就一很普通的2D射击小游戏。简单说一下我觉得比较有意思的地方吧。

<iframe src="//player.bilibili.com/player.html?aid=808243406&bvid=BV1H34y1i7TA&cid=485277313&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

- ##### 游戏框架

  本游戏采用老旧的slick2D+lwjgl框架，大约是13、14年左右比较流行的一套绘图框架，后面就没有维护、逐渐遗弃了。

  这是一套非常简单的轻量级的框架。在本游戏的实现中，我只使用了其绘图函数（底层依赖于OpenGL，调用GPU绘图）与图形相交判断。由于MacOS现在貌似已经不支持OpenGL了，所以此项目只能在windows上运行。

  

  - 碰撞检测

    此游戏框架只能对两个图形做相交检测，所以为了实现多物体的高效处理，我实现了一个AABB Tree加速数据结构，通过将场景内的物体划分到一个个包围和里面来减少相交判断所需的次数。（这里花了挺多时间，可惜的是最后也没用上，浪费了）

  

  - 寻路

    在这个游戏里面，所有人（玩家和电脑）行走路线可以是任意的直线，并不一定是沿竖直或者水平方向，所以在电脑寻路这里我也做了改进。

    通常我们使用的是A星算法，将地图变成一个个的格子（或者其他的方式）再使用A星算法来完成计算，AI行走的路线只能是上下、左右地走，除非加上一些优化，否则就会显得非常坚硬。所以这里使用了一个简化版的、现代游戏设计中常用的navigation mesh数据结构，即导航网络。（项目中名为“polymesh”）通过将地图划分成不同大小的形状、并在其中建立导航网络与导航点来使得电脑的寻路、移动效果更好。

  

  - 动画

    因为slick2D框架所提供的动画不支持旋转，所以为了让玩家与电脑的攻击具有动画效果，我也实现了一个动画效果。当玩家进行射击的时候，玩家操控的小人会因为后坐力使得手臂前后移动。

  

  - 物理

    为了让游戏更有意思，我还嵌入了一部分简单的物理功能，包括物体的碰撞、加速度；电脑能够被玩家射出的子弹击飞等等。说起来挺有意思的是我以前把摩擦阻力减速的参数调的比较小，然后可以当作一个台球游戏来玩。（不支持设置质量，所有小球默认是同等质量的）

   

  

- ##### 设计模式

  - visitor

    为了多线程设计的方便，物体之间通信使用“stateAlter”类作为介质，每个周期物体只需要从队列中取出一个“stateAlter”，然后调用stateAlter.accept()函数即可完成状态的改变。每个物体有两个Vector数组（因为Vector是线程安全的）。其中一个Vector数组作为物体正在处理的“stateAlter”当前队列。另外一个作为辅助队列，当另外一个物体希望对本物体造成伤害时，它只需要自己先生成一个“stateAlter”的子类“damage”，然后在辅助队列上将其挂载上去即可，这样可以很好地减少线程冲突。每次线程同步的时候，每个物体处理完了当前队列，只需要“flip”一下（交换当前队列与辅助队列）即可。

    

  - 组合而非继承

    收到visitor模式的启发，我在本项目中我尝试了一种新的设计方法（类似于插件）

     <img src="D:\My_Study\Code\Java报告\批注 2022-01-16 055708.png" alt="批注 2022-01-16 055708" style="zoom:58%;" />

    每个Creature（玩家、电脑）都会有一个Manipulator队列，其中存着负责“Attack”、“Move”等等功能的Manipulator对象，而每个Manipulator对象都有一个accept方法，所以每个Creature只需要循环调用Manipulator队列中实例的accept方法即可。

    这样的优点就是可以通过替换、增加或者删除Creature对象中不同的Manipulator实例就能生成一个新的不同功能的Creature，避免了设计很多的子类，并且不需要像那样谨慎地设计各个类之间地继承关系。





#### 最后一点想说的

非常遗憾java大作业最后还是没有能够完成。

首先这个学期的课程选的有点多了，图形学、高级Java程序设计、静态程序分析三个课程都有project并且工作量也不小。从第8周所有科目的作业任务突然增加之后，进度就开始逐渐落后了。

高估了自己的代码能力吧，想要不借助过多的框架来完成一个自己的小游戏，但是工程量实在太大了。

其实最后阶段我想要完成maven管理、JUnit测试与对象的序列化从而实现存档。但是在第三方库（slick2D jar包）install进本地仓库地时候又遇到了好多奇奇怪怪地bug与报错，骓不逝兮可奈何，放个假天天三姑二舅喊去吃饭不去又要被骂，我寻思考上大学之前他们可没那么热情啊，心态炸裂了。